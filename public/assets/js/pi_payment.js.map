{"version":3,"sources":["pi_payment.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"pi_payment.js","sourcesContent":["Architekt.event.on('ready', function() {\n\tvar Printer = Architekt.module.Printer;\n\tvar Notice = Architekt.module.Widget.Notice;\n\tvar Confirm = Architekt.module.Widget.Confirm;\n\n\tvar paymentComplete = false;\t//this variable check for complete payment animation if already completed.\n\tvar dom = {\n\t\tmoduleBackground: $('#payment_module_background'),\n\t\tmodule: $('#payment_module'),\n\t\tnavs: $('.payment-nav-item'),\n\t\ttabContainer: $('.payment-tab'),\n\t\ttabs: {\n\t\t\teasy: $('#tab_easy'),\n\t\t\tpi: $('#tab_pi'),\n\t\t\tsms: $('#tab_sms'),\n\t\t\tpayment: $('#tab_payment'),\n\t\t},\n\t};\n\tvar qrCode = new QRCode($('#qrcode').get(0), Architekt.productInfo.address);\n\tvar component = {\n\t\teasy: {\n\t\t\temail: $('#email'),\n\t\t\tpassword: $('#password'),\n\t\t},\n\t\tsms: {\n\t\t\tform: $('#smsForm'),\n\t\t\tcode: $('#authcode'),\n\t\t\tcipher: $('#cipher_id'),\n\t\t\tsubmit: $('#smsSubmit'),\n\t\t},\n\t\tpay: {\n\t\t\tpay: $('#pay'),\n\t\t}\n\t};\n\tvar currentTab = null;\n\tvar previousTab = null;\n\t//socket for check pi-address payment(pi sending)\n\tvar paymentSocket = io('http://devpay.pi-pay.net:8800');\n\n\tfunction _error(text, focus) {\n\t\tnew Notice({\n\t\t\ttext:text,\n\t\t\tcallback: function() {\n\t\t\t\tif(focus) focus.focus();\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction appInit() {\n\t\tattachEvents();\n\t\tcomponentActions();\n\n\t\tcomponent.easy.email.focus();\n\t\tcurrentTab = dom.tabs.easy;\n\t}\n\t\n\tfunction attachEvents() {\n\t\tvar _is_switching_mode = false; //variable for check navigation switching animation\n\t\t\n\t\t//navigation click: switch tab and navigation\n\t\tdom.navs.click(function() {\n\t\t\t//check if clicked already activated nav, exit\n\t\t\tvar idx = $(this).index();\n\t\t\t\n\t\t\tvar targetTab = null;\n\n\t\t\tswitch(idx) {\n\t\t\t\tcase 0:\n\t\t\t\t\ttargetTab = previousTab;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\ttargetTab = dom.tabs.pi;\n\t\t\t\t\tpreviousTab = currentTab;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif(currentTab === targetTab) return;\n\t\t\telse if(currentTab !== dom.tabs.pi && targetTab === previousTab) return;\n\n\n\t\t\tif(_is_switching_mode) return;\n\t\t\t_is_switching_mode = true;\n\n\n\t\t\tdom.navs.removeClass('on');\n\t\t\t$(this).addClass('on');\n\n\t\t\tcurrentTab.fadeOut(300, function() {\n\t\t\t\tcurrentTab = targetTab;\n\t\t\t\tcurrentTab.fadeIn(300, function() {\n\t\t\t\t\t_is_switching_mode = false;\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\t//easy payment - login\n\t\tdom.tabs.easy.submit(function() {\n\t\t\tdom.tabs.easy.fadeOut(300, function() {\n\t\t\t\tcurrentTab = dom.tabs.sms;\n\t\t\t\tdom.tabs.sms.fadeIn(300);\n\t\t\t});\n\n\t\t\treturn false;\n\n\n\t\t\tif(!component.easy.email.val()) {\n\t\t\t\t_error('이메일을 입력해주세요.', component.easy.email);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse if(!component.easy.password.val()) {\n\t\t\t\t_error('비밀번호를 입력해주세요.', component.easy.password);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t\n\t\t});\n\n\t\t//easy payment - sms\n\t\tcomponent.sms.form.submit(function() {\n\t\t\tdom.tabs.sms.fadeOut(300, function() {\n\t\t\t\tcurrentTab = dom.tabs.payment;\n\t\t\t\tdom.tabs.payment.fadeIn(300);\n\t\t\t});\n\t\t\treturn false;\n\n\t\t\tif(!component.sms.code.val()) {\n\t\t\t\t_error('인증 번호를 입력해주세요.', component.sms.code);\n\t\t\t\treturn false;\n\t\t\t}\n\n\n\t\t\treturn false;\n\t\t});\n\n\t\t//easy payment - pay\n\t\tcomponent.pay.pay.click(function() {\n\t\t\tpaymentComplete = true;\n\n\t\t\tdestroyNav();\n\n\t\t\t$('#payment_info').animate({\n\t\t\t\theight: '0',\n\t\t\t\topacity: '0.0'\n\t\t\t}, 300, 'swing', function() {\n\t\t\t\t$(this).remove();\n\t\t\t\tcomponent.pay.pay.addClass('done').text('결제 완료').off('click');\n\n\t\t\t\t$('#payment_complete').delay(100).show().animate({\n\t\t\t\t\theight: '80px',\n\t\t\t\t\topacity: '1.0',\n\t\t\t\t\t'margin-top': '80px',\n\t\t\t\t}, 300, 'swing', function() {\n\t\t\t\t\t$('#receipt').fadeIn(300);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction destroyNav() {\n\t\tdom.navs.fadeOut(300, function() {\n\t\t\t$(this).remove();\n\t\t\tdom.navs = null;\n\t\t});\t\n\t}\n\n\t//definition of common actions for components\n\tfunction componentActions() {\n\t\t$('.pi-payment-text > input').focus(function() {\n\t\t\t$(this).parent().addClass('on');\n\t\t}).blur(function() {\n\t\t\t$(this).parent().removeClass('on');\n\t\t});\n\t}\n\n\t//execute on end of the pi address payment\n\tfunction onAddressPaymentEnd() {\n\t\tif(paymentComplete) return;\n\t\tpaymentComplete = true;\n\n\t\tfunction _after() {\n\t\t\tvar qrwrap = $('#qr_wrap');\n\t\t\tvar completeDom = $('#complete');\n\t\t\tvar priceDom = $('#tab_pi_price');\n\n\t\t\tdestroyNav();\n\n\t\t\tqrwrap.animate({\n\t\t\t\theight: '0',\n\t\t\t\topacity: '0.0'\n\t\t\t}, 300, 'swing', function() {\n\t\t\t\tqrwrap.remove();\n\t\t\t\tqrwrap = null;\n\n\t\t\t\tpriceDom.addClass('done');\n\n\t\t\t\tcompleteDom.delay(100).show().animate({\n\t\t\t\t\theight: '150px',\n\t\t\t\t\tpadding: '80px 32px 32px 32px',\n\t\t\t\t\topacity: '1.0',\n\t\t\t\t}, 500);\n\t\t\t});\n\t\t}\n\n\t\tif(currentTab !== dom.tabs.pi) {\n\t\t\tcurrentTab.fadeOut(150, function() {\n\t\t\t\tdom.tabs.pi.fadeIn(150, _after);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t\t_after();\n\t}\n\n\t/********************************************************************************\n\t *\n\t *\n\t *                             Pi address payment\n\t *\n\t *\n\t ********************************************************************************/\n\n\tvar errorCheck = false;\n\tpaymentSocket.on('invoice-channel.' + Architekt.productInfo.id + ':invoice.payment-start', onAddressPaymentEnd);\n\tpaymentSocket.on('connect_error', function(data) {\n\t\tPrinter.error('Error with payment socket.');\n\t\tPrinter.inspect(data);\n\n\t\tif(!errorCheck) {\n\t\t\terrorCheck = true;\n\n\t\t\tnew Confirm({\n\t\t\t\ttext: '오류가 발생하여 파이 주소 결제가 제대로 동작하지 않습니다. [확인] 버튼을 누르면 페이지를 새로 불러옵니다.',\n\t\t\t\tcallback: function() {\n\t\t\t\t\tlocation.reload();\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t});\n\tpaymentSocket.on('error', function(data) {\n\t\tPrinter.error('Error with payment socket.');\n\t\tPrinter.inspect(data);\n\t});\n\n\n\t//initialize animations\n\tdom.module.fadeIn(300, appInit);\n});"],"sourceRoot":"/source/"}